# Plan C投資判定アプリ - デプロイ情報

## 📱 アプリURL

**本番環境**: https://investment-strategies-kvpiqbzjh7hz9vd2f53apf.streamlit.app/

**デプロイ日**: 2025-10-27
**プラットフォーム**: Streamlit Community Cloud
**認証**: なし（URL推測不可能）

---

## 📂 プロジェクト構成

**GitHubリポジトリ**: https://github.com/TheLunarRock/investment-strategies
**ブランチ**: main
**メインファイル**: `app/plan_c_app.py`

### ファイル構成
```
investment-strategies/
├── app/
│   ├── plan_c_app.py       # メインアプリケーション（1,400行超）
│   ├── requirements.txt    # 依存関係
│   ├── run.sh             # ローカル実行スクリプト
│   └── README.md          # アプリドキュメント
└── README.md              # プロジェクトREADME
```

### 依存関係 (requirements.txt)
```
streamlit==1.39.0
yfinance==0.2.50
pandas==2.2.3
```

---

## 🎯 主要機能

### 1. 暴落判定機能
- **自動取得データ**: VIX、日経平均、S&P500
- **手動入力データ**: バフェット指数
- **判定ロジック**: 日本市場と米国市場を別々に判定（平均化しない）
- **4パターン判定**:
  1. 日本のみ暴落 → 日本資産にのみ追加投資
  2. 米国のみ暴落 → 海外資産にのみ追加投資
  3. 両方暴落 → 両方に追加投資
  4. 通常時 → 30:70の通常配分

### 2. 投資配分計算
- **基本配分**: 日本30% : 海外70%
- **7つのファンド構成**:
  - 🇯🇵 日本資産: 株式15%, REIT10%, 債券5%
  - 🌏 海外資産: 全世界株式40%, 米国株式10%, REIT10%, 債券10%
- **ベース金額**: ユーザー設定可能（デフォルト30万円）

### 3. リバランス機能（2モード）

#### モード1: 月次投資額の範囲内で調整
- 通常の月次投資額内で不足ファンドに重点配分
- 数ヶ月かけて徐々にバランスを整える方法
- 継続期間を自動計算（最大月数を表示）

**計算ロジック**:
```
必要月数 = 不足額 ÷ 月次追加額（切り上げ）
```

#### モード2: 追加資金でリバランス
- 通常の月次投資額＋追加資金を投入
- 不足ファンドに追加資金を優先配分
- 1回の買付で大きく改善可能
- 追加資金が不足している場合は警告表示

**計算ロジック**:
```
通常配分 = ベース金額 × 通常配分比率
追加配分 = 追加資金 × (ファンドの不足額 / 全不足額合計)
最終配分 = 通常配分 + 追加配分
```

### 4. 最低購入金額保証
- 各ファンドで最低購入金額を設定可能（デフォルト3,000円）
- 分散投資を維持（どのファンドも0円にならない）
- リバランス時も全ファンドへの投資を継続

---

## 🔄 アプリ更新手順

### ローカルで修正
```bash
cd /Users/TheLunarRock/Documents/GitHub/investment-strategies/app
# plan_c_app.py を編集
```

### GitHubにプッシュ
```bash
git add app/plan_c_app.py
git commit -m "fix: 修正内容"
git push origin main
```

### 自動デプロイ
- Streamlit Community Cloudが変更を自動検出
- 約2-3分で再デプロイ完了
- アプリURLは変更なし

---

## 📅 月次運用フロー

### 毎月14日：判定実行
1. **アプリURLにアクセス**
   - https://investment-strategies-kvpiqbzjh7hz9vd2f53apf.streamlit.app/
2. **バフェット指数を確認して入力**
   - 日本: 日経平均 ÷ 日本の名目GDP
   - 米国: ウィルシャー5000 ÷ 米国の名目GDP
3. **暴落判定結果を確認**
4. **翌15日の買付金額・配分を確認**
5. **証券会社で自動買付設定を更新**

### リバランス時
1. **現在の保有状況を入力**
2. **リバランスモードを選択**
   - 月次投資額の範囲内で調整（数ヶ月かけて）
   - 追加資金でリバランス（1回で完了）
3. **調整後の金額を確認**
4. **継続期間（月数）を確認**
5. **証券会社で設定変更**
6. **✅ 完了後、必ず通常の金額に戻す**

---

## ⚠️ 重要な注意事項

### リバランス後の設定戻し
- リバランス調整は**一時的な設定**
- 買付完了後は**必ず通常の金額に戻す**
- **戻し忘れ注意**: 継続的に偏った投資になる
- **推奨**: カレンダーリマインダーを設定

### プライバシーとセキュリティ
- ✅ URL推測不可能（ランダム文字列）
- ✅ URLを知っている人のみアクセス可能
- ✅ パブリック検索には表示されない
- ✅ 個人情報なし（市場データのみ）
- ⚠️ このURLを他人に教えないこと
- 💡 必要に応じて後からパスワード認証追加可能

---

## 🎛️ Streamlit Community Cloud管理

### ダッシュボード
**URL**: https://share.streamlit.io/

### 管理機能
- ✅ アプリの稼働状況確認
- ✅ ログ確認（エラーデバッグ）
- ✅ アプリの再起動
- ✅ 環境変数設定
- ✅ アプリの削除

---

## 📊 次回使用予定

**2025年11月14日**（次回判定日）
1. バフェット指数を確認
2. 判定を実行
3. 翌15日の買付設定を更新

---

## 🔧 トラブルシューティング

### アプリが動作しない
1. Streamlit Community Cloudダッシュボードでログ確認
2. GitHubのコミット履歴確認
3. requirements.txtの依存関係確認
4. アプリを再起動

### データ取得エラー
- **原因**: yfinance APIの一時的な制限
- **解決**: 時間をおいて再試行（通常10分以内に回復）

### リバランス計算エラー
- **確認1**: 全てのファンドが入力されているか
- **確認2**: ベース金額 ≥ 最低購入金額の合計（7ファンド × 3,000円 = 21,000円）
- **確認3**: 保有状況の金額が正確か

### 判定結果がおかしい
- **確認1**: バフェット指数の入力値が正確か
- **確認2**: 自動取得データの日付が最新か
- **確認3**: 判定基準値が変更されていないか

---

## 🎉 デプロイ成功！

- [x] GitHubにコードをプッシュ
- [x] Streamlit Community Cloudでデプロイ
- [x] アプリURL取得
- [x] URLをブックマーク保存
- [ ] 次回判定日（2025年11月14日）にアクセステスト

**おめでとうございます！Plan C投資判定アプリが完成・デプロイされました！**
