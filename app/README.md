# Plan C 暴落判定アプリ（日米別判定版）

VIX・株価変動率を自動取得、バフェット指数のみ手動入力で**日本市場と米国市場を別々に判定**

## 🎯 主な特徴

- **日米別判定**: 日本と米国を独立して判定し、暴落した市場にのみ追加投資
- **4パターン対応**: 両方通常、日本のみ暴落、米国のみ暴落、両方暴落
- **自動取得**: VIX・日経平均・S&P500は完全自動
- **手動入力**: バフェット指数2つのみ（1分で完了）

## 📊 機能

| 指標 | 取得方法 | データソース |
|------|----------|--------------|
| VIX指数（共通） | **自動** | Yahoo Finance API |
| 日経平均（3ヶ月変動） | **自動** | Yahoo Finance API |
| S&P500（3ヶ月変動） | **自動** | Yahoo Finance API |
| バフェット指数（日本） | **手動入力** | [nikkeiyosoku.com](https://nikkeiyosoku.com/buffett/) |
| バフェット指数（米国） | **手動入力** | [nikkeiyosoku.com](https://nikkeiyosoku.com/buffett_us/) |

## 🎯 4パターン判定ロジック

### パターン1: 両市場とも通常（年10回）
```
判定: 日本 ✅ 通常 / 米国 ✅ 通常
投資: 通常300k円のみ（自動）
作業: なし
```

### パターン2: 日本のみ暴落（年1-2回）
```
判定: 日本 🚨 暴落 / 米国 ✅ 通常
投資: 通常300k + 追加90k（日本資産のみ）
作業: SBI証券で日本資産に90k円追加買付
備考: 暴落用資金300kは事前に日90k/海210kに配分済み
```

### パターン3: 米国のみ暴落（年1-2回）
```
判定: 日本 ✅ 通常 / 米国 🚨 暴落
投資: 通常300k + 追加210k（海外資産のみ）
作業: SBI証券で海外資産に210k円追加買付
備考: 暴落用資金300kは事前に日90k/海210kに配分済み
```

### パターン4: 両市場とも暴落（稀）
```
判定: 日本 🚨 暴落 / 米国 🚨 暴落
投資: 通常300k + 追加300k（全資産）
作業: SBI証券で全資産に300k円追加買付
```

## 🚀 初回セットアップ（完了済み）

✅ Python 3.13.7 インストール済み
✅ 仮想環境作成済み
✅ ライブラリインストール済み（yfinance, streamlit, pandas）

## 💻 使い方（毎月14日）

### 方法1: 簡単起動（推奨）

```bash
cd /Users/TheLunarRock/Documents/GitHub/investment-strategies/app
./run.sh
```

### 方法2: 手動起動

```bash
cd /Users/TheLunarRock/Documents/GitHub/investment-strategies/app
source venv/bin/activate
streamlit run plan_c_app.py
```

アプリが起動すると、ブラウザが自動で開きます（`http://localhost:8501`）

## 📝 毎月14日の作業フロー

### ステップ1: アプリ起動（10秒）
```bash
./run.sh
```

### ステップ2: バフェット指数の確認と入力（1分）

1. **日本バフェット指数**
   - [日本バフェット指数](https://nikkeiyosoku.com/buffett/)を開く
   - 表示されている数値（例：120.5）をアプリに入力

2. **米国バフェット指数**
   - [米国バフェット指数](https://nikkeiyosoku.com/buffett_us/)を開く
   - 表示されている数値（例：180.2）をアプリに入力

**VIX・日経平均・S&P500は自動で表示されます！**

### ステップ3: 判定結果を確認（5秒）

画面に4つのパターンのいずれかが表示されます。

---

## 📊 判定結果の詳細

### ✅ パターン1: 両市場とも通常（年10回）

```
✅ 両市場とも通常（作業なし）

💰 15日の自動買付
- 通常300,000円のみ（自動実行）
- 日本資産: 90,000円（30%）
- 海外資産: 210,000円（70%）
```

**あなたの作業**: なし（完了！）

---

### 🚨 パターン2: 日本のみ暴落（年1-2回）

```
🚨 日本市場のみ暴落！日本資産に追加投資

📝 14日の作業（所要時間: 5分）

1. SBI証券にログイン
2. 追加90,000円を日本資産のみに買付：
   - eMAXIS Slim 国内株式（TOPIX）: +45,000円
   - eMAXIS Slim 国内リートインデックス: +30,000円
   - eMAXIS Slim 国内債券インデックス: +15,000円
3. 記録（Google Sheetsに記入）

💰 15日の自動買付 + 本日の手動買付

| 資産クラス | 自動（15日） | 手動（14日） | 合計 |
|-----------|------------|------------|------|
| 日本資産 | 90,000円 | +90,000円 | 180,000円 |
| 海外資産 | 210,000円 | - | 210,000円 |
| 合計 | 300,000円 | 90,000円 | 390,000円 |
```

**ポイント**: 日本市場が割安なので、暴落用資金（日本分90k円）を追加投資！30:70の比率を維持。

---

### 🚨 パターン3: 米国のみ暴落（年1-2回）

```
🚨 米国（世界）市場のみ暴落！海外資産に追加投資

📝 14日の作業（所要時間: 7分）

1. SBI証券にログイン
2. 追加210,000円を海外資産のみに買付：
   - eMAXIS Slim 全世界株式（除く日本）: +120,000円
   - eMAXIS Slim 米国株式（S&P500）: +45,000円
   - eMAXIS Slim 先進国リートインデックス: +30,000円
   - eMAXIS Slim 先進国債券インデックス: +15,000円
3. 記録（Google Sheetsに記入）

💰 15日の自動買付 + 本日の手動買付

| 資産クラス | 自動（15日） | 手動（14日） | 合計 |
|-----------|------------|------------|------|
| 日本資産 | 90,000円 | - | 90,000円 |
| 海外資産 | 210,000円 | +210,000円 | 420,000円 |
| 合計 | 300,000円 | 210,000円 | 510,000円 |
```

**ポイント**: 米国・世界市場が割安なので、暴落用資金（海外分210k円）を追加投資！30:70の比率を維持。

---

### 🚨🚨 パターン4: 両市場とも暴落（稀）

```
🚨🚨 日米両市場とも暴落！全資産に追加投資

📝 14日の作業（所要時間: 10分）

1. SBI証券にログイン
2. 追加300,000円を全資産に買付（通常配分）：

   日本資産（+90,000円）：
   - eMAXIS Slim 国内株式（TOPIX）: +45,000円
   - eMAXIS Slim 国内リートインデックス: +30,000円
   - eMAXIS Slim 国内債券インデックス: +15,000円

   海外資産（+210,000円）：
   - eMAXIS Slim 全世界株式（除く日本）: +120,000円
   - eMAXIS Slim 米国株式（S&P500）: +45,000円
   - eMAXIS Slim 先進国リートインデックス: +30,000円
   - eMAXIS Slim 先進国債券インデックス: +15,000円

3. 記録（Google Sheetsに記入）

💰 15日の自動買付 + 本日の手動買付

| 資産クラス | 自動（15日） | 手動（14日） | 合計 |
|-----------|------------|------------|------|
| 日本資産 | 90,000円 | +90,000円 | 180,000円 |
| 海外資産 | 210,000円 | +210,000円 | 420,000円 |
| 合計 | 300,000円 | 300,000円 | 600,000円 |
```

**ポイント**: 日米両市場が割安！全資産に通常配分で追加投資！

---

## 🔍 トラブルシューティング

### エラー: VIXデータ取得失敗
**原因**: インターネット接続 or Yahoo Finance API障害
**対処**: 数分待ってから再実行

### エラー: 株価データ不足
**原因**: 市場休場日 or データ取得タイミング
**対処**:
1. 前日（13日）に実行してみる
2. それでもダメなら手動で確認（[Google Finance](https://www.google.com/finance)）

### アプリが起動しない
**対処**:
```bash
# 仮想環境を再度有効化
cd /Users/TheLunarRock/Documents/GitHub/investment-strategies/app
source venv/bin/activate
streamlit run plan_c_app.py
```

## 📅 実行タイミング

| 日付 | 作業 | 理由 |
|------|------|------|
| **毎月14日** | アプリで判定 | 15日買付の準備 |
| 毎月15日 | なし（自動実行） | SBI証券が自動買付 |

## 💡 ポイント

- **所要時間**: 通常月2分、暴落月7-10分（年2-3回のみ）
- **自動化率**: 約70%（VIX・株価は完全自動）
- **手動入力**: バフェット指数2つのみ（1分）
- **失敗しても安心**: 15日の通常買付は自動で必ず実行される
- **日米別判定**: 暴落した市場にのみ追加投資（理にかなった戦略）

## 📦 ファイル構成

```
app/
├── plan_c_app.py     # メインアプリケーション（日米別判定版）
├── run.sh            # 起動スクリプト（簡単起動用）
├── README.md         # このファイル
└── venv/             # Python仮想環境（自動生成）
```

## 🔄 今後の拡張（オプション）

現在実装済みの機能で十分ですが、将来的に以下の拡張が可能：

### Phase 2: 完全自動化（+3時間）
- Playwright でバフェット指数も自動取得
- 完全にボタンを押すだけに

### Phase 3: 通知機能（+2時間）
- LINE Notify で判定結果を自動送信
- メールでリマインダー

**現時点では不要：** 月2分の作業で十分管理可能

---

## 🎯 日米別判定 + 配分比率維持の優位性

### 問題のあった例（従来版：平均化）
```
日本バフェット: 120%（割高）
米国バフェット: 40%（超割安）
平均: 80% → 追加投資300k円

❌ 問題: 割高な日本にも300k円×30%=90k円追加投資してしまう
```

### 改善された例（新版：日米別判定 + 配分比率維持）
```
日本バフェット: 120%（割高） → 通常投資のみ
米国バフェット: 40%（超割安） → 暴落用資金210k円を追加

✅ 正解:
- 日本：通常90k円のみ（暴落用90k円は使わない）
- 米国：通常210k円 + 暴落用210k円 = 合計420k円
- 30:70の比率を維持しながら、割安市場に集中投資
```

### この方式の3つのメリット

1. **真に割安な市場にのみ追加投資**
   - 暴落していない市場の暴落用資金は温存
   - 将来その市場が暴落した時のために残す

2. **30:70の配分比率を常に維持**
   - 長期的なバランスを保つ
   - リスク分散の原則に忠実

3. **暴落用資金の事前配分が明確**
   - 日本用: 90k円
   - 海外用: 210k円
   - 管理がシンプルで分かりやすい

**結論**: 日米別判定により、真に割安な市場にのみ資金を集中しつつ、配分比率も維持できる！

---

**バージョン**: 2.1（日米別判定 + 配分比率維持版）
**最終更新**: 2025年10月27日
**動作環境**: Python 3.13.7 / macOS
